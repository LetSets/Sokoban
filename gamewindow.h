#ifndef GAMEWINDOW_H
#define GAMEWINDOW_H

#include <QMainWindow>
#include <QKeyEvent>
#include <QPaintEvent>
#include <QKeyEvent>
#include <QCloseEvent>
#include <QString>
#include <QVector>
#include <QDebug>
#include <QLabel>
#include <QFont>
#include <QPushButton>
#include <QMessageBox>
#include "map.h"
#include "player.h"

class GameWindow : public QMainWindow
{
    Q_OBJECT
private:
    int game_idx=0;
    Map* gameMap[10][16];
    Player* player;
    QLabel* scoreLabel;
    QLabel* recordLabel;
    QPushButton* manualBtn;
    QMessageBox* manualBox;
    int step=0;
    int finalCount=0;
    static inline int greatest_step[10]={0,0,0,0,0,0,0,0,0,0};
    void drawGameMap(QPainter* painter);
    void judgeWin();
    int MapList[10][10][16]=
        {
            {
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,1,3,1,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0},
                {0,0,0,0,1,1,1,2,0,2,3,1,0,0,0,0},
                {0,0,0,0,1,3,0,2,0,1,1,1,0,0,0,0},
                {0,0,0,0,1,1,1,1,2,1,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,1,3,1,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0},
                {0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0},
                {0,0,0,0,1,0,2,2,1,0,1,1,1,0,0,0},
                {0,0,0,0,1,0,2,0,1,0,1,3,1,0,0,0},
                {0,0,0,0,1,1,1,0,1,1,1,3,1,0,0,0},
                {0,0,0,0,0,1,1,0,0,0,0,3,1,0,0,0},
                {0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0},
                {0,0,0,0,0,1,0,0,0,1,1,1,1,0,0,0},
                {0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0},
                {0,0,0,0,1,0,0,0,0,0,1,1,1,0,0,0},
                {0,0,0,1,1,2,1,1,1,0,0,0,1,0,0,0},
                {0,0,0,1,0,0,0,2,0,0,2,0,1,0,0,0},
                {0,0,0,1,0,3,3,1,0,2,0,1,1,0,0,0},
                {0,0,0,1,1,3,3,1,0,0,0,1,0,0,0,0},
                {0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0},
                {0,0,0,0,1,1,0,0,1,0,0,0,0,0,0,0},
                {0,0,0,0,1,0,2,0,1,0,0,0,0,0,0,0},
                {0,0,0,0,1,1,2,0,1,1,0,0,0,0,0,0},
                {0,0,0,0,1,1,0,2,0,1,0,0,0,0,0,0},
                {0,0,0,0,1,3,2,0,0,1,0,0,0,0,0,0},
                {0,0,0,0,1,3,3,3,3,1,0,0,0,0,0,0},
                {0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0},
                {0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0},
                {0,0,0,0,0,1,0,2,0,0,1,0,0,0,0,0},
                {0,0,0,0,1,1,1,0,1,0,1,1,0,0,0,0},
                {0,0,0,0,1,3,1,0,1,0,0,1,0,0,0,0},
                {0,0,0,0,1,3,2,0,0,1,0,1,0,0,0,0},
                {0,0,0,0,1,3,0,0,0,2,0,1,0,0,0,0},
                {0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0},
                {0,0,0,0,0,1,1,0,0,1,0,0,1,0,0,0},
                {0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0},
                {0,0,0,0,0,1,2,0,2,0,2,0,1,0,0,0},
                {0,0,0,0,0,1,0,2,1,1,0,0,1,0,0,0},
                {0,0,0,1,1,1,0,2,0,1,0,1,1,0,0,0},
                {0,0,0,1,3,3,3,3,3,0,0,1,0,0,0,0},
                {0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0},
                {0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0},
                {0,0,0,1,1,3,0,2,1,1,0,1,1,0,0,0},
                {0,0,0,1,3,3,2,0,2,0,0,0,1,0,0,0},
                {0,0,0,1,3,3,0,2,0,2,0,1,1,0,0,0},
                {0,0,0,1,1,1,1,1,1,0,0,1,0,0,0,0},
                {0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0},
                {0,0,0,1,0,0,1,1,0,0,0,1,0,0,0,0},
                {0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,0},
                {0,0,0,1,2,0,1,1,1,0,2,1,0,0,0,0},
                {0,0,0,1,0,1,3,3,3,1,0,1,0,0,0,0},
                {0,0,1,1,0,1,3,3,3,1,0,1,1,0,0,0},
                {0,0,1,0,2,0,0,2,0,0,2,0,1,0,0,0},
                {0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0},
                {0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0},
                {0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0},
                {0,0,0,0,1,1,1,2,2,2,0,1,0,0,0,0},
                {0,0,0,0,1,0,0,2,3,3,0,1,0,0,0,0},
                {0,0,0,0,1,0,2,3,3,3,1,1,0,0,0,0},
                {0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0},
                {0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            },
            {
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,1,1,1,1,0,0,1,1,1,1,1,0,0},
                {0,0,1,1,0,0,1,0,0,1,0,0,0,1,0,0},
                {0,0,1,0,2,0,1,1,1,1,2,0,0,1,0,0},
                {0,0,1,0,0,2,3,3,3,3,0,2,0,1,0,0},
                {0,0,1,1,0,0,0,0,1,0,0,0,1,1,0,0},
                {0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            }
        };
    QPoint playerPos[10]={QPoint(600,375),
                          QPoint(375,75),
                          QPoint(375,300),
                          QPoint(375,225),
                          QPoint(450,150),
                          QPoint(825,150),
                          QPoint(825,300),
                          QPoint(750,525),
                          QPoint(375,375),
                          QPoint(750,450)
    };
    QVector<QVector<Direction>> moveStack;   //二元组第一个元素表示上一步方向，第二个表示人的朝向
public:
    explicit GameWindow(QWidget *parent = nullptr);
    explicit GameWindow(QWidget *parent = nullptr,int idx = 0);
    void startGame();
    void paintEvent(QPaintEvent*);
    void keyPressEvent(QKeyEvent* event);
    void closeEvent(QCloseEvent* event);
    void nextGame();
    ~GameWindow();
};
#endif // GAMEWINDOW_H
